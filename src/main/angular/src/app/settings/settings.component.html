<!--
  ~ Copyright (C) 2017 Axel MÃ¼ller <axel.mueller@avanux.de>
  ~
  ~ This program is free software; you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License as published by
  ~ the Free Software Foundation; either version 2 of the License, or
  ~ (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU General Public License for more appliance.
  ~
  ~ You should have received a copy of the GNU General Public License along
  ~ with this program; if not, write to the Free Software Foundation, Inc.,
  ~ 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
  -->
<form [formGroup]="form" (ngSubmit)="submitForm()">
  <section>
    <h2>{{'SettingsComponent.holidays' | translate}}</h2>
    <div class="fields">
      <mat-checkbox formControlName="holidaysEnabled" (click)="toggleHolidaysEnabled()"
      >{{'SettingsComponent.holidaysEnabled' | translate}}</mat-checkbox>
      <mat-form-field class="holidaysUrl">
        <mat-label>{{'SettingsComponent.holidaysUrl' | translate}}</mat-label>
        <input matInput type="text" formControlName="holidaysUrl"
               placeholder="{{settingsDefaults.holidaysUrl}}"
               required="{{formHandler.isRequired('holidaysUrl')}}">
        <mat-error *ngIf="errors.holidaysUrl">{{errors.holidaysUrl}}</mat-error>
      </mat-form-field>
    </div>
  </section>

  <mat-divider></mat-divider>

  <section>
    <h2>{{'SettingsComponent.modbus' | translate}}</h2>
    <div formArrayName="modbus">
      <div *ngFor="let modbusFormGroup of modbusFormArray.controls;let i = index;last as l" [formGroupName]="i">
        <div class="fields">
          <mat-form-field class="modbusTcpId">
            <mat-label>{{'SettingsComponent.modbusTcpId' | translate}}</mat-label>
            <input matInput type="text" formControlName="modbusTcpId"
                   required="{{formHandler.isRequired('modbusTcpId')}}">
          </mat-form-field>
          <mat-form-field class="modbusTcpHost">
            <mat-label>{{'SettingsComponent.modbusTcpHost' | translate}}</mat-label>
            <input matInput type="text" formControlName="modbusTcpHost"
                   required="{{formHandler.isRequired('modbusTcpHost')}}">
            <mat-error *ngIf="errors.modbusTcpHost">{{errors.modbusTcpHost}}</mat-error>
          </mat-form-field>
          <mat-form-field class="modbusTcpPort">
            <mat-label>{{'SettingsComponent.modbusTcpPort' | translate}}</mat-label>
            <input matInput type="text" formControlName="modbusTcpPort"
                   required="{{formHandler.isRequired('modbusTcpPort')}}">
            <mat-error *ngIf="errors.modbusTcpPort">{{errors.modbusTcpPort}}</mat-error>
          </mat-form-field>
          <button mat-button (click)="addModbus()" *ngIf="l"><mat-icon>add_circle_outline</mat-icon></button>
          <button mat-button (click)="removeModbus(i)"><mat-icon>remove_circle_outline</mat-icon></button>
        </div>
      </div>
      <div *ngIf="settings.modbusSettings.length === 0">
        <button mat-button (click)="addModbus()"><mat-icon>add_circle_outline</mat-icon></button>
      </div>
    </div>
  </section>


  <div class="mandatory-fields">{{'dialog.mandatoryfields'|translate}}</div>
  <button mat-raised-button type="submit" color="primary" [disabled]="form.pristine||form.invalid">
    {{'button.save' | translate}}</button>
</form>
